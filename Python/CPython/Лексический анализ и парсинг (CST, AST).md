–ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –±—ã–ª–∞ —Å–æ–±—Ä–∞–Ω–∞ –≤—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞–∑–æ–±—Ä–∞–Ω –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –±–∞–π—Ç –∫–æ–¥–∞. –≠—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑–±–∏—Ç –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç—Ç–∞–ø–æ–≤.

```
(–ú–æ–¥—É–ª—å —á—Ç–µ–Ω–∏—è) --—Ç–µ–∫—Å—Ç--> 
(–ú–æ–¥—É–ª—å –ª–µ–∫—Å–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞) --CST-->  üëàüèª
(–ü–∞—Ä—Å–µ—Ä) --AST-->  üëàüèª
(–ö–æ–º–ø–∏–ª—è—Ç–æ—Ä)
```

### –ú–æ–¥—É–ª—å –ª–µ–∫—Å–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

1. **–õ–µ–∫—Å–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑**
–¢–µ–∫—Å—Ç –∫–æ–¥–∞ —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —Ç–æ–∫–µ–Ω—ã - —Å–ª–æ–≤–∞ –∏ —Å–∏–º–≤–æ–ª—ã (`if`, `+`, `42`, `'hello'`)

2. **–°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑**

**–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã CST –¥–µ—Ä–µ–≤–∞** –∏–∑ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –≤—ã—à–µ —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã. 

–í CPython (–∑–¥–µ—Å—å –∏ –≤–µ–∑–¥–µ –¥–∞–ª–µ–µ –¥–ª—è –≤–µ—Ä—Å–∏–∏ 3.9) —ç—Ç–∏ —à–∞–≥–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `PyParser_ParseFileObject` (`Parser/parsetok.c`)
	1. –°–æ–∑–¥–∞–µ—Ç—Å—è —ç–∫–∑–µ–º–ø–ª—è—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä–∞ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `PyTokenizer_FromFile` (`Parser/tokenizer.c`)
	2. –≠—Ç–æ—Ç —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Ñ—É–Ω–∫—Ü–∏—é `parsetok` (`Parser/parsetok.c`)
		1. –° –ø–æ–º–æ—â—å—é —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä–∞ –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–π —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é `tok_get` (`Parser/tokenizer.c`) –∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `PyTokenizer_Get` (`Parser/tokenizer.c`)
		2. –î–∞–ª–µ–µ –∏–∑ —Ç–æ–∫–µ–Ω–∞ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –Ω–æ–¥–∞ –∏ –∫–ª–∞–¥–µ—Ç—Å—è –≤ –¥–µ—Ä–µ–≤–æ CST
		3. 1 –∏ 2 –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –ø–æ–∫–∞ –∫—É—Ä—Å–æ—Ä —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä–∞ –Ω–µ –¥–æ–π–¥–µ—Ç –¥–æ –∫–æ–Ω—Ü–∞ —Å—Ç—Ä–æ–∫–∏

![[Pasted image 20251225000224.png]]

–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É–∑–ª–∞ –∏–∑ `Include/node.h`
```c
typedef struct _node {
    short               n_type;
    char                *n_str;
    int                 n_lineno;
    int                 n_col_offset;
    int                 n_nchildren;
    struct _node        *n_child;
    int                 n_end_lineno;
    int                 n_end_col_offset;
} node;
```

**–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ AST –¥–µ—Ä–µ–≤–∞** –∏–∑ –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ CST –¥–µ—Ä–µ–≤–∞

*–ê –≤ —á–µ–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É CST –∏ AST?*
CST —Ä–µ—à–∞–µ—Ç –∑–∞–¥–∞—á—É –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ —è–∑—ã–∫–∞ - —Ç–æ, –∫–∞–∫ –∫–æ–¥ –¥–æ–ª–∂–µ–Ω –≤—ã–≥–ª—è–¥–µ—Ç—å –∞ –Ω–µ –∫–∞–∫ –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–Ω—è—Ç. AST —É–∂–µ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ —Å–º—ã—Å–ª–∞ - –æ–Ω "–æ—á–∏—â–∞–µ—Ç—Å—è" –æ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–≥–æ —à—É–º–∞.
–ü—Ä–∏–º–µ—Ä: `(a + b) * c` –∏ `a + b * c` c —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏ (CST) –æ–±–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –≤–∞–ª–∏–¥–Ω—ã, —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è —Å–º—ã—Å–ª–∞ (AST) –æ–Ω–∏ —Å–æ–≤–µ—Ä–µ—à–Ω–Ω–æ —Ä–∞–∑–Ω—ã–µ (—Ä–∞–∑–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π).

–í CPython —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è ast –ª–µ–∂–∏—Ç –≤ `Python/ast.c` —Ç–∏–ø—ã —É–∑–ª–æ–≤ AST –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ –º–æ–¥—É–ª–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ `Include/Python-ast.h`, –∫–æ—Ç–æ—Ä—ã–π –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è c –ø–æ–º–æ—â—å—é `Parser/asdl_c.py` —á–µ—Ä–µ–∑ —Ñ–∞–π–ª –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–µ ASDL 5 `Parser/Python.asdl`.  

–í—Ö–æ–¥–Ω–æ–π —Ç–æ—á–∫–æ–π –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è AST —è–≤–ª—è–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è `PyAST_FromNodeObject` (`Python/ast.c`). –§—É–Ω–∫—Ü–∏—è –ø–æ —Å–≤–æ–µ–π —Å—É—Ç–∏ - —ç—Ç–æ –±–æ–ª—å—à–æ–π swich case –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ `TYPE(n)`, –≥–¥–µ `n` - –∫–æ—Ä–Ω–µ–≤–∞—è –Ω–æ–¥–∞ CTS, –∞ `TYPE` - –º–∞–∫—Ä–æ—Å, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞ —É–∑–ª–∞ CST.

–§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–∏–ø `mod_ty` Python –º–æ–¥—É–ª—å, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–∑ `Python-ast.h`. `mod_ty` - —ç—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è 4-—Ö —Ç–∏–ø–æ–≤ –º–æ–¥—É–ª–µ–π Python: `Module`, (–¥–ª—è –∑–∞–ø—É—Å–∫–∞ —á–µ—Ä–µ–∑ —Ñ–∞–π–ª `python main.py`) `Interactive` (–¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ REPL), `Expression` (–¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ `eval`), `FunctionType` (–æ—á–µ–Ω—å —Ä–µ–¥–∫–æ–µ Python C API —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–µ).

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –µ—Å—Ç—å —Å–≤–æ—è —Ñ—É–Ω–∫—Ü–∏—è `ast_for_xxx`–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è CST —É–∑–ª–∞ –∫ AST —É–∑–ª—É. –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è —É–∑–ª–∞ –≤–æ–∑–≤–µ–¥–µ–Ω–∏—è –≤ —Å—Ç–µ–ø–µ–Ω—å `x ** y` –Ω–∞–ø–∏—Å–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è

```c
static expr_ty
ast_for_power(struct compiling *c, const node *n)
{
    /* power: atom trailer* ('**' factor)*
     */
    expr_ty e;
    REQ(n, power);
    e = ast_for_atom_expr(c, CHILD(n, 0));
    if (!e)
        return NULL;
    if (NCH(n) == 1)
        return e;
    if (TYPE(CHILD(n, NCH(n) - 1)) == factor) {
        expr_ty f = ast_for_expr(c, CHILD(n, NCH(n) - 1));
        if (!f)
            return NULL;
        e = BinOp(e, Pow, f, LINENO(n), n->n_col_offset,
                  n->n_end_lineno, n->n_end_col_offset, c->c_arena);
    }
    return e;
}
```

–ü–æ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –±—É–¥–µ—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ —á–∞—Å—Ç—å –¥–µ—Ä–µ–≤–∞ –≤–∏–¥–∞

```
(expr)
  |
  \/
(BinOp)
  |    |     |
  \/   \/    \/
(Num) (Pow) (Num)
```


### –î–∞–ª–µ–µ [–ö–æ–º–ø–∏–ª—è—Ç–æ—Ä](–ö–æ–º–ø–∏–ª—è—Ç–æ—Ä)

