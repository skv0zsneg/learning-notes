Динамическое программирование - это решение сложных задачи путем их разбиения на подзадачи.

Разберем его через задачу с вором. У вора есть рюкзак емкостью 4 и он нашел 3 предмета разной стоимости: 
- магнитофон вес 4, стоимость $3000; 
- ноутбук вес 3, стоимость $2000;
- гитара вес 1, стоимость $1500.
Необходимо  собрать предметы максимальной стоимостью.

Какие варианты решения? 

**Перебором**

Перебрать все комбинации: пусто - $0; гитара - $1500; магнитофон - $3000; ноутбук -  $2000; гитара+магнитофон - не помещается; гитара + ноутбук - $3500 ... и так далее.

Но это долго. Сложность растет по $O(2^n)$.

**Жадные (NP-полные) алгоритмы**

Такое решение не будет оптимальным, но будет быстрым.

Мы возьмем самый дорогой предмет, если останется место то возьмем следующий самый дорогой и так далее пока не закончиться место. В нашем случае мы возьмем только магнитофон, так как он заполнит весь рюкзак и является самым дорогим.

Сложность будет $O(n)$ , так как в худшем случае мы пройдемся по всем предметам.

**Динамическое программирование**

Возможно ли все-таки получить оптимальное решение за приемлемую сложность? Да, с помощью динамического программирования. В нашем случае мы будем решать задачу разбивая рюкзак на подрюкзаки. 

Для начала, строится таблица. Когда она будет полностью заполнена мы найдем решение.

| Предметы\Размеры   | 1   | 2   | 3   | 4   |
| ------------------ | --- | --- | --- | --- |
| Гитара 1/$1500     | -   | -   | -   | -   |
| Магнитофон 4/$3000 | -   | -   | -   | -   |
| Ноутбук 3/$2000    | -   | -   | -   | -   |

Далее мы должны заполнять каждую строчку сверху вниз слева направо. В каждую ячейку мы вносим (по определенной формуле, но про это позже) итоговую цену для текущего размера предмета или предметов. 

Для строки "Гитара" для размера один стоимость будет $1500 так как: гитара вмещается и это единственный предмет. И так далее для всех ячеек.

| Предметы\Размеры   | 1         | 2         | 3         | 4         |
| ------------------ | --------- | --------- | --------- | --------- |
| Гитара 1/$1500     | $1500 (Г) | $1500 (Г) | $1500 (Г) | $1500 (Г) |
| Магнитофон 4/$3000 | -         | -         | -         | -         |
| Ноутбук 3/$2000    | -         | -         | -         | -         |

Для строки "Магнитофон" интереснее. Для размера 1 Магнитофон не поместится, так как он большего размера, значит лучшем решением для этого же размера (самое дорогое) будет предыдущее - $1500 за гитару. И так далее до 4 размера. А на последнем Магнитофон уже вмещается, и он дороже предыдущего решения, поэтому в последнюю ячейку вписываем его. 

| Предметы\Размеры   | 1         | 2         | 3         | 4         |
| ------------------ | --------- | --------- | --------- | --------- |
| Гитара 1/$1500     | $1500 (Г) | $1500 (Г) | $1500 (Г) | $1500 (Г) |
| Магнитофон 4/$3000 | $1500 (Г) | $1500 (Г) | $1500 (Г) | $3000 (М) |
| Ноутбук 3/$2000    | -         | -         | -         | -         |
Для строки "Ноутбук" еще интереснее. Первые два размера будут также заполнены гитарой, так как ноутбук не вмещается. Далее для размера 3 - ноутбук является лучшем решением, так как дороже предыдущего (гитара за $1500).

И вот ключевой момент. Последняя ячейка. Варианты ее заполнения: 
- предыдущее решение - Магнитофон за $3000 без свободного места
- текущая строка - Ноутбук за $2000 с 1 одним свободным местом
Казалось бы, Магнитофон побеждает так как он дороже, но в случае с Ноутбуком у нас остается пустое место размером 1 и мы можем его использовать. Лучшее предыдущее решение для ячейки размером 1 - это гитара стоимостью $1500. Тогда, используя освободившееся место под гитару получаем еще один вариант:
- текущая строка - Ноутбук за $2000 + Гитара за $1500 размером 1 = $3500

| Предметы\Размеры   | 1         | 2         | 3         | 4           |
| ------------------ | --------- | --------- | --------- | ----------- |
| Гитара 1/$1500     | $1500 (Г) | $1500 (Г) | $1500 (Г) | $1500 (Г)   |
| Магнитофон 4/$3000 | $1500 (Г) | $1500 (Г) | $1500 (Г) | $3000 (М)   |
| Ноутбук 3/$2000    | $1500 (Г) | $1500 (Г) | $2000 (Н) | $3500 (Н+Г) |
Вот и получаем оптимальное решение.

Каждая ячейка тут рассчитывается по конкретной формуле:

![[Pasted image 20251110212905.png]]

### Упражнение

*Задача*: Предположим , к предметам добавился еще один: МРЗ-плеер. Он весит 1 фунт и стоит $1000. Стоит ли брать его?

Решение: Нужно добавить еще одну строку и дополнить таблицу 

| Предметы\Размеры   | 1         | 2         | 3         | 4           |
| ------------------ | --------- | --------- | --------- | ----------- |
| Гитара 1/$1500     | $1500 (Г) | $1500 (Г) | $1500 (Г) | $1500 (Г)   |
| Магнитофон 4/$3000 | $1500 (Г) | $1500 (Г) | $1500 (Г) | $3000 (М)   |
| Ноутбук 3/$2000    | $1500 (Г) | $1500 (Г) | $2000 (Н) | $3500 (Н+Г) |
| МРЗ-плеер 1/$1000  | -         | -         | -         | -           |
- Для размера 1 остается Гитара, так как она дороже плеера - это лучшее решение. 
- Для размера 2 лучшем решением является предыдущее - Гитара $1500, однако остается одно пустое место, которое можно использовать - МР3-плеер за $1000. Тогда в ячейке будет значение $2500.
- Для размера 3 лучшее предыдущее решение - это ноутбук за $2000, однако если использовать плеер и заполнить пустые 2 места лучшем предыдущим - Гитара за $1500, получим $2500, что дороже одного ноутбука. Тогда это значение пишем в ячейку.
- Финал: для размера 4 лучшее предыдущее значение $3500 ноутбук + гитара, если мы будем использовать только плеер, то останется 3 свободного времени. Предыдущее лучшее решение для размера  3 - это ноутбук. Получается $3000 Ноутбук + Плеер. Это меньше, чем предыдущее лучшее решение для размера 4, поэтому оставляем предыдущее.

| Предметы\Размеры   | 1         | 2           | 3           | 4           |
| ------------------ | --------- | ----------- | ----------- | ----------- |
| Гитара 1/$1500     | $1500 (Г) | $1500 (Г)   | $1500 (Г)   | $1500 (Г)   |
| Магнитофон 4/$3000 | $1500 (Г) | $1500 (Г)   | $1500 (Г)   | $3000 (М)   |
| Ноутбук 3/$2000    | $1500 (Г) | $1500 (Г)   | $2000 (Н)   | $3500 (Н+Г) |
| МРЗ-плеер 1/$1000  | $1500 (Г) | $2500 (Г+П) | $2500 (Г+П) | $3500 (Н+Г) |
Ответ: брать плеер не стоит.

#### Что произойдет при добавлении меньшего размера?

До этого таблица работала для единичных размеров (1-4), а что если у нас появится вещь вес которой 0.5? Придется пересчитать все значения таблицы с учетом меньших весов.

| Предметы\Размеры   | 0.5 | 1   | 1.5 | 2   | 2.5 | 3   | 3.5 | 4   |
| ------------------ | --- | --- | --- | --- | --- | --- | --- | --- |
| Гитара 1/$1500     | -   | -   | -   | -   | -   | -   | -   | -   |
| Магнитофон 4/$3000 | -   | -   | -   | -   | -   | -   | -   | -   |
| Ноутбук 3/$2000    | -   | -   | -   | -   | -   | -   | -   | -   |
| Ожерелье 0.5/$1000 | -   | -   | -   | -   | -   | -   | -   | -   |

#### Можно ли взять часть предмета?

Нет. Динамическое программирование не может решить задачу для части предметов. Мы либо берем предмет либо нет (все или ничего).

### Оптимизация туристического маршрута

Решим методом динамического программирования такую задачу. Мы приехали в лондон и нам нужно посетить достопримечательности. Везде побывать не получиться, поэтому мы составили список из мест, времени которое необходимо для его посещения и его оценка (насколько нам важно его посетить)

| Место       | Время   | Оценка |
| ----------- | ------- | ------ |
| Вестминстер | 0.5 дня | 7      |
| Театр       | 0.5 дня | 6      |
| Галерея     | 1 день  | 9      |
| Музей       | 2 дня   | 9      |
| Собор       | 0.5 дня | 8      |
Нам нужно, по оценке, посетить все места максимально эффективно. Это можно решить методом динамического программирования.

Как и в прошлый раз у нас будет таблица, которую нужно будет заполнить. Вместо предметов - места, вместо размера - дни, вместо цены - наша оценка.

| Места\Дни         | 0.5   | 1        | 1.5        | 2          |
| ----------------- | ----- | -------- | ---------- | ---------- |
| Вестминстер 0,5/7 | 7 (В) | 7 (В)    | 7 (В)      | 7 (В)      |
| Театр 0,5/6       | 7 (В) | 13 (В+Т) | 13 (В+Т)   | 13 (В+Т)   |
| Галерея 1/9       | 7 (В) | 13 (В+Т) | 16 (Г+В)   | 22 (Г+В+Т) |
| Музей 2/9         | 7 (В) | 13 (В+Т) | 16 (Г+В)   | 22 (Г+В+Т) |
| Собор 0,5/8       | 8 (С) | 15 (С+В) | 21 (С+В+Т) | 24 (С+Г+В) |
Получается, что самым оптимальным для нас будет посетить Собор, Галерею и Вестминстер!

#### А если одна подзадача зависит от другой?

Допустим, как в прошлой задаче, мы добавим две достопримечательности из Парижа -- лувр и нотердам. 

Получится ли учесть поездку до Парижа из Лондона при вычислениях в таблице? Нет. Динамическое программирование работает только в том случае, если каждая подзадача автономна, то есть не зависит от других подзадач.

### Упражнение

*Задача*: Предположим, что вы собираетесь в турпоход. Емкость вашего рюк­зака составляет 6 фунтов, и вы можете взять предметы из следующего списка . У каждого предмета имеется стоимость; чем она выше, тем важнее предмет :
- вода, 3 фунта, 10;
- книга, 1 фунт, 3;
- еда, 2 фунта, 9;
- куртка, 2 фунта, 5;
- камера, 1 фунт, 6

*Решение*:

| Предмет/Емкость | 1      | 2      | 3         | 4            | 5            | 6           |
| --------------- | ------ | ------ | --------- | ------------ | ------------ | ----------- |
| Вода 3ф/10      | -      | -      | 10 (В)    | 10 (В)       | 10 (В)       | 10 (В)      |
| Книга 1ф/3      | 3 (Кн) | 3 (Кн) | 10 (В)    | 13 (В+Кн)    | 13 (В+Кн)    | 13 (В+Кн)   |
| Еда 2ф/9        | 3 (Кн) | 9 (Е)  | 12 (Кн+Е) | 13 (В+Кн)    | 19 (Е+В)     | 22 (Е+В+Кн) |
| Куртка 2ф/5     | 3 (Кн) | 9 (Е)  | 12 (Кн+Е) | 14 (Ку+Е)    | 19 (Е+В)     | 22 (Е+В+Кн) |
| Камеры 1ф/6     | 6 (Ка) | 9 (Е)  | 15 (Ка+Е) | 18 (Ка+Кн+Е) | 20 (Ка+Ку+Е) | 25 (Ка+Е+В) |
Таким образом, оптимальным по ценности набором в рюкзаке будет: Камеры, Еда и Вода.