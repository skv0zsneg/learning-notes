## №1 и №2 Докажите, что операции UNION, INTERSECT, PROD, JOIN коммутативны и ассоциативны

Отношение **Билеты**

| ticket_no      | int    |
| -------------- | ------ |
| book_ref       | string |
| passanger_name | string |

и **Бронирование**

| book_ref     | string  |
| ------------ | ------- |
| book_date    | date    |
| total_amount | decimal |

и **Пассажир** для примера

| passanger_name    | string |
| ----------------- | ------ |
| passanger_surname | string |
| passanger_sex     | string |

Коммутативность — это такая операция при применении которой на ряд членов в их любом порядке результат не изменится.

Официальная запись: `x ° y = y ° x`
Пример: 2 + 3 = 3 + 2; 2 * 3 = 3 * 2.

Ассоциативная операция — это операция, для которой порядок выполнения не влияет на результат при группировке элементов. Формально, операция ∘ является ассоциативной, если для любых элементов `a`, `b` и `c` выполняется следующее условие:

Официальная запись: `(a ∘ b) ∘ c = a ∘ (b ∘ c)`
Пример: 2 + (3 + 4) = (2 + 3) + 4

---
#### UNION
*В результат включаются кортежи входящие в первый или второй аргумент.*

Пусть есть множество для отношения билеты 

**S**

| ticket_no | book_ref | passanger_name |
| --------- | -------- | -------------- |
| 2         | "ASG7"   | "Вася"         |
| 3         | "ASG9"   | "Петя"         |
и **R**

| ticket_no | book_ref | passanger_name |
| --------- | -------- | -------------- |
| 2         | "ASG7"   | "Вася"         |
| 4         | "EWW"    | "Иван"         |
и **M**

| ticket_no | book_ref | passanger_name |
| --------- | -------- | -------------- |
| 4         | "EWW"    | "Иван"         |
| 7         | "IOb"    | "Галина"       |

**Пояснения коммутативность**

Результатом операции `S UNION R` и `R UNION S`будет отношение:

| ticket_no | book_ref | passanger_name |
| --------- | -------- | -------------- |
| 2         | "ASG7"   | "Вася"         |
| 3         | "ASG9"   | "Петя"         |
| 4         | "EWW"    | "Иван"         |

- Кортеж `(2, "ASG7", "Вася")` входит и в `S` и в `R` множества что подходит под оба условия - `S` ИЛИ `R` и `R` ИЛИ `S`.
- Кортеж `(3, "ASG9", "Петя")` входит в `S` но НЕ входит в `R` множество, что подходит под оба условия - `S` ИЛИ `R` и `R` ИЛИ `S`.
- Кортеж `(4, "EWW", "Иван")` НЕ входит в `S` но входит в `R` множество, что подходит под оба условия - `S` ИЛИ `R` и `R` ИЛИ `S`.

**Пояснения ассоциативность**

Результатом операции `(S UNION R) UNION M` и `S UNION (R UNION M)`будет отношение:

| ticket_no | book_ref | passanger_name |
| --------- | -------- | -------------- |
| 2         | "ASG7"   | "Вася"         |
| 3         | "ASG9"   | "Петя"         |
| 4         | "EWW"    | "Иван"         |
| 7         | "IOb"    | "Галина"       |

Группировка тут - всего лишь отложенное действие как если бы операция шла без скобок. Операция тут будет аккумулировать результат в каком бы видно множества не группировались. **Операция ассоциативна**. 


---
#### INTERSECT
*Результат содержит только кортежи, входящие в первый и второй аргументы.*

Пусть есть множество для отношения билеты 

**S**

| ticket_no | book_ref | passanger_name |
| --------- | -------- | -------------- |
| 2         | "ASG7"   | "Вася"         |
| 3         | "ASG9"   | "Петя"         |
| 4         | "EWW"    | "Иван"         |
и **R**

| ticket_no | book_ref | passanger_name |
| --------- | -------- | -------------- |
| 2         | "ASG7"   | "Вася"         |
| 4         | "EWW"    | "Иван"         |
и **M**

| ticket_no | book_ref | passanger_name |
| --------- | -------- | -------------- |
| 4         | "EWW"    | "Иван"         |
| 7         | "IOb"    | "Галина"       |

**Пояснения коммутативность**

Результатом операции `S INTERSECT R` и `R INTERSECT S` будет отношение:

| ticket_no | book_ref | passanger_name |
| --------- | -------- | -------------- |
| 2         | "ASG7"   | "Вася"         |

Кортеж `(3, "ASG9", "Петя")` из `S` нет в `R` и кортеж `(4, "EWW", "Иван")` из `R` нет в `S`. Такая проверка будет проведена при любом положении отношений в операции, следовательно операция коммутативна. Результат - это единственный кортеж появляющийся в обеих множествах - `[(2, "ASG7", "Вася")]`

**Пояснения ассоциативность**

Результатом операции `(S INTERSECT R) INTERSECT M` и `S INTERSECT (R INTERSECT M)`будет отношение:

| ticket_no | book_ref | passanger_name |
| --------- | -------- | -------------- |
| 4         | "EWW"    | "Иван"         |

Каждый результат INTERSECT будет понемногу "урезать" отношение пока не останется только то множество строчек, которое будет общим для всех множеств в операции. Таким образом группировка ни на что не влияет и операция может считаться ассоциативной. 

---
#### PROD
*Прямое декартово произведение (или просто декартово произведение) двух отношений (таблиц) создает новое отношение, которое содержит все возможные комбинации строк из обоих исходных отношений.*

Пусть есть множество для отношения  

билеты **S**

| ticket_no | book_ref | passanger_name |
| --------- | -------- | -------------- |
| 2         | "ASG7"   | "Вася"         |
| 3         | "ASG9"   | "Петя"         |
и бронирование **R**

| book_ref | book_date | total_amount |
| -------- | --------- | ------------ |
| "ASG7"   | 1/1/1970  | 450          |
| "ASG9"   | 2/12/2020 | 1 050        |
и пассажира **M**

| passanger_name | passanger_surname | passanger_sex |
| -------------- | ----------------- | ------------- |
| "Вася"         | "Вакуленко"       | "Мужской"     |
| "Жанна"        | "Дарк"            | "Женский"     |


**Пояснения коммутативность**

Результатом операции `S PROD R` и `R PROD S` будет отношение:

| ticket_no | book_ref | passanger_name | book_ref | book_date | total_amount |
| --------- | -------- | -------------- | -------- | --------- | ------------ |
| 2         | "ASG7"   | "Вася"         | "ASG7"   | 1/1/1970  | 450          |
| 2         | "ASG7"   | "Вася"         | "ASG9"   | 2/12/2020 | 1 050        |
| 3         | "ASG9"   | "Петя"         | "ASG7"   | 1/1/1970  | 450          |
| 3         | "ASG9"   | "Петя"         | "ASG9"   | 2/12/2020 | 1 050        |

Операция порождает отношение, содержащее все атрибуты из обеих отношений `R` и `S`, а также все возможные комбинации каждого множества из `R` с каждым множеством из `S`. Получается, что вне зависимости от порядка отношений в операции `PRDO` результат будет одинаковым, таким образом операция коммутативна.

**Пояснения ассоциативность**

Результатом операции `(S PROD R) PROD M` и `S PROD (R PROD M)`будет отношение:

| ticket_no | book_ref | passanger_name | book_ref | book_date | total_amount | passanger_name | passanger_surname | passanger_sex |
| --------- | -------- | -------------- | -------- | --------- | ------------ | -------------- | ----------------- | ------------- |
| 2         | "ASG7"   | "Вася"         | "ASG7"   | 1/1/1970  | 450          | "Вася"         | "Вакуленко"       | "Мужской"     |
| 2         | "ASG7"   | "Вася"         | "ASG9"   | 2/12/2020 | 1 050        | "Вася"         | "Вакуленко"       | "Мужской"     |
| 2         | "ASG7"   | "Вася"         | "ASG7"   | 1/1/1970  | 450          | "Жанна"        | "Дарк"            | "Женский"     |
| 2         | "ASG7"   | "Вася"         | "ASG9"   | 2/12/2020 | 1 050        | "Жанна"        | "Дарк"            | "Женский"     |
| 3         | "ASG9"   | "Петя"         | "ASG7"   | 1/1/1970  | 450          | "Вася"         | "Вакуленко"       | "Мужской"     |
| 3         | "ASG9"   | "Петя"         | "ASG9"   | 2/12/2020 | 1 050        | "Вася"         | "Вакуленко"       | "Мужской"     |
| 3         | "ASG9"   | "Петя"         | "ASG7"   | 1/1/1970  | 450          | "Жанна"        | "Дарк"            | "Женский"     |
| 3         | "ASG9"   | "Петя"         | "ASG9"   | 2/12/2020 | 1 050        | "Жанна"        | "Дарк"            | "Женский"     |

Каждый результат операции в одной группировке порождает комбинацию из переданных ей множеств и далее комбинацию результата с третьем множеством и так далее аккумулируя. Очевидно, что в конце концов все множества между собой образуют все возможные комбинации каждой строки между собой. Таким образом операция ассоциативна.  

---
#### JOIN
*Объединяет строки из двух отношений на основе некоторого условия.*

Далее примеры будут для следующих отношений

билеты **S**

| ticket_no | book_ref | passanger_name |
| --------- | -------- | -------------- |
| 2         | "ASG7"   | "Вася"         |
| 3         | "ASG9"   | "Петя"         |
| 4         | "WWE"    | "Катя"         |
и бронирование **R**

| book_ref | book_date  | total_amount |
| -------- | ---------- | ------------ |
| "ASG7"   | 1/1/1970   | 450          |
| "ASG9"   | 2/12/2020  | 1 050        |
| "LOL9"   | 27/07/2024 | 2 600 000    |
и пассажира **M**

| passanger_name | passanger_surname | passanger_sex |
| -------------- | ----------------- | ------------- |
| "Вася"         | "Вакуленко"       | "Мужской"     |
| "Жанна"        | "Дарк"            | "Женский"     |

Существует 4 типа `JOIN` операций
#### INNER JOIN
*Возвращает только те строки, которые имеют совпадающие значения атрибутов в обоих отношениях.*

**Пояснения коммутативность**

Результатом операций `S INNER JOIN R` и `R INNER JOIN S` будет отношение:

| ticket_no | book_ref | passanger_name | book_date | total_amount |
| --------- | -------- | -------------- | --------- | ------------ |
| 2         | "ASG7"   | "Вася"         | 1/1/1970  | 450          |
| 3         | "ASG9"   | "Петя"         | 2/12/2020 | 1 050        |

Множество `S` имеет совпадающие значения по атрибуту `book_ref` с множеством `R`, а именно `"ASG7"` и `"ASG9"`. По определению операции в результат включаются только те комбинации множеств, которые имеют эти совпадающие атрибуты.
Раз так, то вне зависимости от порядка множеств в операции `INNER JOIN` порядок не изменится, следовательно **операция коммутативна**.

#### LEFT JOIN
*Возвращает все строки из левого отношения и совпадающие строки из правого отношения. Если нет совпадения, результат будет содержать `NULL` для столбцов из правого отношения.*

Результатом операции `S LEFT JOIN R` будет отношение:

| book_ref | ticket_no | passanger_name | book_date | total_amount |
| -------- | --------- | -------------- | --------- | ------------ |
| "ASG7"   | 2         | "Вася"         | 1/1/1970  | 450          |
| "ASG9"   | 3         | "Петя"         | 2/12/2020 | 1 050        |
| "WWE"    | 4         | "Катя"         | NULL      | NULL         |
Результатом операции `R LEFT JOIN S` будет отношение:

| book_ref | ticket_no | passanger_name | book_date  | total_amount |
| -------- | --------- | -------------- | ---------- | ------------ |
| "ASG7"   | 2         | "Вася"         | 1/1/1970   | 450          |
| "ASG9"   | 3         | "Петя"         | 2/12/2020  | 1 050        |
| "LOL9"   | NULL      | NULL           | 27/07/2024 | 2 600 000    |

> Порядок в данном и во всех других случаях не имеет значение.

**Пояснения**
В самом названии выражения выражается приоритет одному из выражений (левому). В данном случае то множество, которое стоит слева в выражении будет полностью включено в результирующее отношение. В свою очередь из множества справа в результат войдут только те строчки, которые имеют общий атрибут с левым множеством. Для не найденных "пар" для левых строчек в значения атрибутов правого выражения будут записаны NULL.
Очевидно, что в случае перестановки множеств в выражении ответ изменится, таким образом **операция НЕ коммутативна**.

### RIGHT JOIN
*`RIGHT JOIN` возвращает все строки из правого отношения и совпадающие строки из левого отношения. Если нет совпадения, результат будет содержать `NULL` для столбцов из левого отношения.*

Здесь все тоже самое, что и для LEFT JOIN, но приоритет будет отдаваться правому множеству в выражении. **Операция НЕ коммутативна**.

### FULL JOIN

`FULL JOIN` возвращает все строки, когда есть совпадение в одном из отношений. Если нет совпадения, результат будет содержать `NULL` для столбцов из другого отношения.

Результатом операций `S FULL JOIN R` и `R FULL JOIN S` будет отношение:

| book_ref | ticket_no | passanger_name | book_date  | total_amount |
| -------- | --------- | -------------- | ---------- | ------------ |
| "ASG7"   | 2         | "Вася"         | 1/1/1970   | 450          |
| "ASG9"   | 3         | "Петя"         | 2/12/2020  | 1 050        |
| "LOL9"   | NULL      | NULL           | 27/07/2024 | 2 600 000    |
| "WWE"    | 4         | "Катя"         | NULL       | NULL         |
**Пояснения**
Как в случае с `RIGHT` и `LEFT` операциям `JOIN` здесь устанавливается приоритет, но в этот раз обеим множествам по обе стороны в выражении. То есть и для левых и для правых строчек их множеств, если не было найдено пары - устанавливается `NULL`.
Таким образом **операция коммутативна**.

---


## №3 Докажите, что выполняются дистрибутивные законы для PROD и JOIN относительно UNION и INTERSECT, а также для UNION относительно INTERSECT, INTERSECT относительно UNION.

Пропуск.

---

## №4 
*В схеме с курсами и студентами предусмотрите возможность ведения занятий по курсу несколькими преподавателями. Экзамен может сдаваться не тому преподавателю, который вел занятия.*

Судя по условиям:
1. Одни курс могут вести разные преподаватели. И один преподаватель может вести разные курсы. Связь между преподавателем и курсом многие ко многим.
2. Экзамен может сдаваться не тому преподавателю, который вел курс. Значит в отношение экзамен добавляется атрибут внешний ключ, который ссылается на любого преподавателя.

В результате получаем такую схему:

![[students_scheme.drawio (1).png]]

---

## №5
*Укажите отклонения от третьей нормальной формы в демонстрационной базе данных.*
![[5249383878022522550.jpg]]

Третья нормальная форма - это транзитивные зависимости. Если имеются функциональные зависимости (а рамках одного отношения) `X → Y` и `Y → Z`, то существует еще и зависимость `X → Z`, которая является суперпозицией первых двух. Такие комбинации функциональных зависимостей приводят к аномалиям, потому что каждый комплект значений атрибутов из `Z` будет повторен вместе с соответствующими значениями атрибутов из `Y`

Не понимаю :(